# Protocol Documentation
<a name="top"></a>

## Table of Contents

- [openoffload.proto](#openoffload-proto)
    - [ActionParameters](#opi_api-security-firewall-v1-ActionParameters)
    - [AddSessionResponse](#opi_api-security-firewall-v1-AddSessionResponse)
    - [SessionId](#opi_api-security-firewall-v1-SessionId)
    - [SessionRequest](#opi_api-security-firewall-v1-SessionRequest)
    - [SessionRequestArgs](#opi_api-security-firewall-v1-SessionRequestArgs)
    - [SessionResponse](#opi_api-security-firewall-v1-SessionResponse)
    - [SessionResponseError](#opi_api-security-firewall-v1-SessionResponseError)
    - [SessionResponses](#opi_api-security-firewall-v1-SessionResponses)
  
    - [ActionType](#opi_api-security-firewall-v1-ActionType)
    - [AddSessionStatus](#opi_api-security-firewall-v1-AddSessionStatus)
    - [IpVersion](#opi_api-security-firewall-v1-IpVersion)
    - [ProtocolId](#opi_api-security-firewall-v1-ProtocolId)
    - [RequestStatus](#opi_api-security-firewall-v1-RequestStatus)
    - [SessionCloseCode](#opi_api-security-firewall-v1-SessionCloseCode)
    - [SessionState](#opi_api-security-firewall-v1-SessionState)
  
    - [SessionTable](#opi_api-security-firewall-v1-SessionTable)
  
- [uuid.proto](#uuid-proto)
    - [Uuid](#opi_api-common-v1-Uuid)
  
- [Scalar Value Types](#scalar-value-types)



<a name="openoffload-proto"></a>
<p align="right"><a href="#top">Top</a></p>

## openoffload.proto



<a name="opi_api-security-firewall-v1-ActionParameters"></a>

### ActionParameters
MIRROR and SNOOP require an actionNextHop
DROP and FORWARD do not have an actionNextHop
The IPV4 nextHop definition maps to the V4 struct returned by inet_pton which is a uint32_t.
The IPV6 nextHop definition maps to the V6 struct returned by inet_ptoN which is a uint8_t s6_addr[16]
PROXY require a src/dst IPv4 or IPv6 address to be set
In the case of a QUIC proxy, srcconnid and dstconnid are also required
proxysrcv4 and proxydstv4 maps to the V5 struct returned by inet_pton which is a uint32_t.
proxysrcv6 and proxydstv6 maps tothe V6 struct returned by inet_ptoN which is a uint8_t s6_addr[16]
srcconnid maps to the raw bytes of the source QUIC connection ID
dstconnid maps to the raw bytes of the destination QUIC connection ID


| Field | Type | Label | Description |
| ----- | ---- | ----- | ----------- |
| actiontype | [ActionType](#opi_api-security-firewall-v1-ActionType) |  |  |
| actionnexthop | [uint32](#uint32) |  |  |
| actionnexthopv6 | [bytes](#bytes) |  |  |
| proxysrcv4 | [uint32](#uint32) |  |  |
| proxydstv4 | [uint32](#uint32) |  |  |
| proxysrcv6 | [bytes](#bytes) |  |  |
| proxydstv6 | [bytes](#bytes) |  |  |
| srcconnid | [bytes](#bytes) |  |  |
| dstconnid | [bytes](#bytes) |  |  |






<a name="opi_api-security-firewall-v1-AddSessionResponse"></a>

### AddSessionResponse
In v1apha4 the errorstatus was added to act as a bitmask
of errors for each of the sesssions sent in a stream (max 64).


| Field | Type | Label | Description |
| ----- | ---- | ----- | ----------- |
| requeststatus | [AddSessionStatus](#opi_api-security-firewall-v1-AddSessionStatus) |  |  |
| errorstatus | [uint64](#uint64) |  |  |
| starttime | [google.protobuf.Timestamp](#google-protobuf-Timestamp) |  |  |
| responseerror | [SessionResponseError](#opi_api-security-firewall-v1-SessionResponseError) | repeated |  |






<a name="opi_api-security-firewall-v1-SessionId"></a>

### SessionId
should the Application assign the sessionID on AddSession and avoid conflicts
or have the applications have a mechanism to avoid duplicate sessionIDs across 
applications since there will be many applications instances to 1 switch


| Field | Type | Label | Description |
| ----- | ---- | ----- | ----------- |
| session_id | [uint64](#uint64) |  |  |






<a name="opi_api-security-firewall-v1-SessionRequest"></a>

### SessionRequest
SessionId is generated by client and passed in via gRPC call
The IPV4 definition maps to the V4 struct returned by inet_pton which is a uint32_t.
The IPV6 definition maps to the V6 struct returned by inet_ptoN which is a uint8_t s6_addr[16]


| Field | Type | Label | Description |
| ----- | ---- | ----- | ----------- |
| session_id | [opi_api.common.v1.Uuid](#opi_api-common-v1-Uuid) |  |  |
| inlif | [int32](#int32) |  |  |
| outlif | [int32](#int32) |  |  |
| ipversion | [IpVersion](#opi_api-security-firewall-v1-IpVersion) |  |  |
| sourceip | [uint32](#uint32) |  |  |
| sourceipv6 | [bytes](#bytes) |  |  |
| sourceport | [uint32](#uint32) |  |  |
| destinationip | [uint32](#uint32) |  |  |
| destinationipv6 | [bytes](#bytes) |  |  |
| destinationport | [uint32](#uint32) |  |  |
| protocolid | [ProtocolId](#opi_api-security-firewall-v1-ProtocolId) |  |  |
| action | [ActionParameters](#opi_api-security-firewall-v1-ActionParameters) |  |  |
| cachetimeout | [uint32](#uint32) |  |  |
| srcconnid | [bytes](#bytes) |  | Used for QUIC connections |
| dstconnid | [bytes](#bytes) |  | Used for QUIC connections |






<a name="opi_api-security-firewall-v1-SessionRequestArgs"></a>

### SessionRequestArgs



| Field | Type | Label | Description |
| ----- | ---- | ----- | ----------- |
| sessionid | [opi_api.common.v1.Uuid](#opi_api-common-v1-Uuid) |  | If SessionId is zero, return all sessions |
| sessionstate | [SessionState](#opi_api-security-firewall-v1-SessionState) |  | Filter argument to only return sessions of a given state |






<a name="opi_api-security-firewall-v1-SessionResponse"></a>

### SessionResponse



| Field | Type | Label | Description |
| ----- | ---- | ----- | ----------- |
| sessionid | [opi_api.common.v1.Uuid](#opi_api-common-v1-Uuid) |  |  |
| inpackets | [uint64](#uint64) |  |  |
| outpackets | [uint64](#uint64) |  |  |
| inbytes | [uint64](#uint64) |  |  |
| outbytes | [uint64](#uint64) |  |  |
| sessionstate | [SessionState](#opi_api-security-firewall-v1-SessionState) |  |  |
| sessionclosecode | [SessionCloseCode](#opi_api-security-firewall-v1-SessionCloseCode) |  |  |
| requeststatus | [RequestStatus](#opi_api-security-firewall-v1-RequestStatus) |  |  |
| starttime | [google.protobuf.Timestamp](#google-protobuf-Timestamp) |  |  |
| endtime | [google.protobuf.Timestamp](#google-protobuf-Timestamp) |  |  |






<a name="opi_api-security-firewall-v1-SessionResponseError"></a>

### SessionResponseError



| Field | Type | Label | Description |
| ----- | ---- | ----- | ----------- |
| sessionid | [opi_api.common.v1.Uuid](#opi_api-common-v1-Uuid) |  |  |
| errorstatus | [int32](#int32) |  |  |






<a name="opi_api-security-firewall-v1-SessionResponses"></a>

### SessionResponses



| Field | Type | Label | Description |
| ----- | ---- | ----- | ----------- |
| sessioninfo | [SessionResponse](#opi_api-security-firewall-v1-SessionResponse) | repeated |  |
| nextkey | [uint64](#uint64) |  |  |





 


<a name="opi_api-security-firewall-v1-ActionType"></a>

### ActionType


| Name | Number | Description |
| ---- | ------ | ----------- |
| _DROP | 0 |  |
| _FORWARD | 1 |  |
| _MIRROR | 2 |  |
| _SNOOP | 3 |  |
| _PROXY | 4 |  |



<a name="opi_api-security-firewall-v1-AddSessionStatus"></a>

### AddSessionStatus
Errors for adding a session
If all sessions are successful inserted return _ACCEPTED

If check of session capacity in offload device is insufficient to add all sessions 
do not insert any sessions and return  _REJECTED_SESSION_TABLE_FULL. It is the 
responsibility of the client to re-try

If the server is unavailable for some other reason then return _REJECTED_SESSION_TABLE_UNAVAILABLE.
It is the  responsibility of the client to re-try

All other errors will return _REJECTED with a buit mask of the failed sessions and it is the responsibility
of the client to address the issues

AddSessionStatus Codes Description

_SESSION_ACCEPTED: Session is accepted by the server and the client performs normal operation
_SESSION_REJECTED: Session is rejected by the server as the message 
   is invalid, the client needs to correct the error.
_SESSION_TABLE_FULL: Session is rejected by the server as its session table is full, 
   the client needs to backoff until more space is available
_SESSION_TABLE_UNAVAILABLE: Session is rejected by the server due to an internal error 
   in the server, the client needs to back off until error is corrected.
_SESSION_ALREADY_EXISTS: Session is rejected by the the server as it already exists 
   in the server session table, the client will take corrective action to ensure state is consistent.

| Name | Number | Description |
| ---- | ------ | ----------- |
| _SESSION_ACCEPTED | 0 |  |
| _SESSION_REJECTED | 1 |  |
| _SESSION_TABLE_FULL | 2 |  |
| _SESSION_TABLE_UNAVAILABLE | 3 |  |
| _SESSION_ALREADY_EXISTS | 4 |  |



<a name="opi_api-security-firewall-v1-IpVersion"></a>

### IpVersion


| Name | Number | Description |
| ---- | ------ | ----------- |
| _IPV4 | 0 |  |
| _IPV6 | 1 |  |



<a name="opi_api-security-firewall-v1-ProtocolId"></a>

### ProtocolId


| Name | Number | Description |
| ---- | ------ | ----------- |
| _HOPOPT | 0 |  |
| _TCP | 6 |  |
| _UDP | 17 |  |



<a name="opi_api-security-firewall-v1-RequestStatus"></a>

### RequestStatus
RequestStatus Codes Description

_ACCEPTED: Normal operation
_REJECTED: Unknown error in the format of the REQUEST message
_REJECTED_SESSION_NONEXISTENT: In getSession or deleteSession the server does not have the session
   in its session table. The client needs to reconcile the system state.
_REJECTED_SESSION_TABLE_FULL: This should never happen as getClosedSessions, getSession, deleteSession never add sessions.
_REJECTED_SESSION_ALREADY_EXISTS: This should never happen as getClosedSessions, getSession, deleteSession never add sessions.
_NO_CLOSED_SESSIONS: When getClosedSessions returns with no closed sessions it will return 0 sessions. There should be no
   message attached so not sure if this is valid.
_REJECTED_INTERNAL_ERROR: The server has an internal error and cannot serivce the request.
   The client must log the error and optionally retry or skip the request.

| Name | Number | Description |
| ---- | ------ | ----------- |
| _ACCEPTED | 0 |  |
| _REJECTED | 1 |  |
| _REJECTED_SESSION_NONEXISTENT | 2 |  |
| _REJECTED_SESSION_TABLE_FULL | 3 |  |
| _REJECTED_SESSION_ALREADY_EXISTS | 4 |  |
| _NO_CLOSED_SESSIONS | 5 |  |
| _REJECTED_INTERNAL_ERROR | 6 |  |



<a name="opi_api-security-firewall-v1-SessionCloseCode"></a>

### SessionCloseCode


| Name | Number | Description |
| ---- | ------ | ----------- |
| _NOT_CLOSED | 0 |  |
| _FINACK | 1 |  |
| _RST | 2 |  |
| _TIMEOUT | 3 |  |
| _UNKNOWN_CLOSE_CODE | 4 |  |



<a name="opi_api-security-firewall-v1-SessionState"></a>

### SessionState


| Name | Number | Description |
| ---- | ------ | ----------- |
| _ESTABLISHED | 0 |  |
| _CLOSING_1 | 1 |  |
| _CLOSING_2 | 2 |  |
| _CLOSED | 3 |  |
| _UNKNOWN_STATE | 4 |  |


 

 


<a name="opi_api-security-firewall-v1-SessionTable"></a>

### SessionTable
The session table was combined with the statistices service
in v1alpha4 to simplfy the code.

| Method Name | Request Type | Response Type | Description |
| ----------- | ------------ | ------------- | ------------|
| AddSession | [SessionRequest](#opi_api-security-firewall-v1-SessionRequest) stream | [AddSessionResponse](#opi_api-security-firewall-v1-AddSessionResponse) | Adds a session This was changed in v1alpha4 to be a streaming API, for performance reasons. |
| GetSession | [SessionId](#opi_api-security-firewall-v1-SessionId) | [SessionResponse](#opi_api-security-firewall-v1-SessionResponse) | Obtains the session |
| DeleteSession | [SessionId](#opi_api-security-firewall-v1-SessionId) | [SessionResponse](#opi_api-security-firewall-v1-SessionResponse) | Delete a session |
| GetAllSession | [SessionRequestArgs](#opi_api-security-firewall-v1-SessionRequestArgs) | [SessionResponses](#opi_api-security-firewall-v1-SessionResponses) | Stream back a specific session or all current sessions To stream a single session, pass SessionId as zero |

 



<a name="uuid-proto"></a>
<p align="right"><a href="#top">Top</a></p>

## uuid.proto



<a name="opi_api-common-v1-Uuid"></a>

### Uuid



| Field | Type | Label | Description |
| ----- | ---- | ----- | ----------- |
| value | [string](#string) |  |  |





 

 

 

 



## Scalar Value Types

| .proto Type | Notes | C++ | Java | Python | Go | C# | PHP | Ruby |
| ----------- | ----- | --- | ---- | ------ | -- | -- | --- | ---- |
| <a name="double" /> double |  | double | double | float | float64 | double | float | Float |
| <a name="float" /> float |  | float | float | float | float32 | float | float | Float |
| <a name="int32" /> int32 | Uses variable-length encoding. Inefficient for encoding negative numbers – if your field is likely to have negative values, use sint32 instead. | int32 | int | int | int32 | int | integer | Bignum or Fixnum (as required) |
| <a name="int64" /> int64 | Uses variable-length encoding. Inefficient for encoding negative numbers – if your field is likely to have negative values, use sint64 instead. | int64 | long | int/long | int64 | long | integer/string | Bignum |
| <a name="uint32" /> uint32 | Uses variable-length encoding. | uint32 | int | int/long | uint32 | uint | integer | Bignum or Fixnum (as required) |
| <a name="uint64" /> uint64 | Uses variable-length encoding. | uint64 | long | int/long | uint64 | ulong | integer/string | Bignum or Fixnum (as required) |
| <a name="sint32" /> sint32 | Uses variable-length encoding. Signed int value. These more efficiently encode negative numbers than regular int32s. | int32 | int | int | int32 | int | integer | Bignum or Fixnum (as required) |
| <a name="sint64" /> sint64 | Uses variable-length encoding. Signed int value. These more efficiently encode negative numbers than regular int64s. | int64 | long | int/long | int64 | long | integer/string | Bignum |
| <a name="fixed32" /> fixed32 | Always four bytes. More efficient than uint32 if values are often greater than 2^28. | uint32 | int | int | uint32 | uint | integer | Bignum or Fixnum (as required) |
| <a name="fixed64" /> fixed64 | Always eight bytes. More efficient than uint64 if values are often greater than 2^56. | uint64 | long | int/long | uint64 | ulong | integer/string | Bignum |
| <a name="sfixed32" /> sfixed32 | Always four bytes. | int32 | int | int | int32 | int | integer | Bignum or Fixnum (as required) |
| <a name="sfixed64" /> sfixed64 | Always eight bytes. | int64 | long | int/long | int64 | long | integer/string | Bignum |
| <a name="bool" /> bool |  | bool | boolean | boolean | bool | bool | boolean | TrueClass/FalseClass |
| <a name="string" /> string | A string must always contain UTF-8 encoded or 7-bit ASCII text. | string | String | str/unicode | string | string | string | String (UTF-8) |
| <a name="bytes" /> bytes | May contain any arbitrary sequence of bytes. | string | ByteString | str | []byte | ByteString | string | String (ASCII-8BIT) |

